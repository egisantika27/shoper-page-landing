const getCookie=a=>{const b=`; ${document.cookie}`,c=b.split(`; ${a}=`);return 2===c.length?c.pop().split(";").shift():null},getQueryParams=()=>{"URLSearchParams"in window;const a=new URLSearchParams(window.location.search);return{ttclid:a.get("ttclid"),fbclid:a.get("fbclid")}},getClientInfo=()=>{let a=localStorage.getItem("sessionId");return a||(a=crypto.randomUUID(),localStorage.setItem("sessionId",a)),{sessionId:a,url:window.location.href,referrer:document.referrer,userAgent:navigator.userAgent,fbc:getCookie("_fbc"),fbp:getCookie("_fbp"),ttp:getCookie("_ttp"),...getQueryParams()}};export const trackEvent=async(a,b)=>{try{console.log(`Mempersiapkan pengiriman event '${a}'...`);const c=getClientInfo(),d={eventName:a,eventId:crypto.randomUUID(),eventData:{value:b.value??1,currency:b.currency??"IDR",contentType:b.contentType??"page",contents:b.contents??null,...b},clientInfo:c};const e=await fetch("https://psstmdfdoantnlmicvcp.supabase.co/functions/v1/events-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!e.ok)throw new Error(`Events Log API error: ${e.statusText}`);const f=await e.json();console.log(`✅ Event '${a}' berhasil dikirim ke events-log:`,f)}catch(a){console.error("❌ Gagal mengirim event tracking:",a)}};