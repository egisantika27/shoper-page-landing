import {trackEvent} from "./tracking.js";const modalOverlay=document.getElementById("successModal"),installBtn=document.getElementById("installButton"),leadForm=document.getElementById("leadForm"),loadingMsg=document.getElementById("loadingMsg"),errorMsg=document.getElementById("formErrorMsg"),closeModalBtn=document.getElementById("closeModalBtn");function showModal(){modalOverlay&&modalOverlay.classList.add("show")}function closeModal(){modalOverlay&&modalOverlay.classList.remove("show"),closeModalBtn&&closeModalBtn.classList.remove("visible")}function setFormStatus(a,b=null){if(loadingMsg)loadingMsg.style.display=a?"block":"none";if(errorMsg)errorMsg.textContent=b||"",errorMsg.style.display=b?"block":"none";const c=leadForm.querySelector('button[type="submit"]');c&&(c.disabled=a)}function validateForm(){let a=!0;return leadForm.querySelectorAll("input[required]").forEach(b=>{const c=document.getElementById(`err-${b.id}`);b.checkValidity()?(b.classList.remove("invalid"),c&&"none"!==c.style.display&&(c.style.display="none")):(b.classList.add("invalid"),c&&"block"!==c.style.display&&(c.style.display="block"),a=!1)}),a}export function setupFormHandler(){leadForm&&leadForm.addEventListener("submit",async a=>{a.preventDefault(),setFormStatus(!1);if(!validateForm())return void setFormStatus(!1,"Harap isi semua kolom dengan format yang benar.");setFormStatus(!0);const b=new FormData(leadForm),c={nama:b.get("nama")?.toString().trim()||"",email:b.get("email")?.toString().trim()||"",phone:b.get("phone")?.toString().trim()||""};try{const a=await fetch("https://shoper-api-endpoint-vercel.vercel.app/api/collect-lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),d=await a.json();setFormStatus(!1),a.ok&&d.success?(showModal(),leadForm.reset()):(setFormStatus(!1,"Email sudah terdaftar"===d.error?"Email ini sudah terdaftar. Silakan gunakan email lain.":"Terjadi kesalahan saat pengiriman data. Silakan coba lagi."),console.error("Server error:",d.error||"Unknown error"))}catch(a){setFormStatus(!1,"Gagal mengirim data. Silakan periksa koneksi internet Anda."),console.error("Request error:",a)}}),closeModalBtn&&closeModalBtn.addEventListener("click",closeModal),installBtn&&closeModalBtn&&installBtn.addEventListener("click",()=>{closeModalBtn.classList.add("visible")})}