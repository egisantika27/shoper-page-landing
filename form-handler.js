import{trackEvent as t}from"./tracking.js";const e=document.getElementById("successModal"),o=document.getElementById("installButton"),n=document.getElementById("leadForm"),r=document.getElementById("loadingMsg"),a=document.getElementById("formErrorMsg"),s=document.getElementById("closeModalBtn");function i(t,e=null){r&&(r.style.display=t?"block":"none"),a&&(a.textContent=e||"",a.style.display=e?"block":"none");const o=n.querySelector('button[type="submit"]');o&&(o.disabled=t)}function l(){let t=!0;return n.querySelectorAll("input[required]").forEach(e=>{const o=document.getElementById(`err-${e.id}`);e.checkValidity()?(e.classList.remove("invalid"),o&&"none"!==o.style.display&&(o.style.display="none")):(e.classList.add("invalid"),o&&"block"!==o.style.display&&(o.style.display="block"),t=!1)}),t}function c(){e&&e.classList.add("show")}function d(){e&&e.classList.remove("show"),s&&s.classList.remove("visible")}export function initFormHandler(){n&&n.addEventListener("submit",async e=>{e.preventDefault(),i(!0),l()||(i(!1,"Harap isi semua kolom dengan benar."),void 0);const r=new FormData(n),a={nama:r.get("nama")?.toString().trim()||"",email:r.get("email")?.toString().trim()||"",phone:r.get("phone")?.toString().trim()||""};try{const e=await fetch("https://shoper-api-endpoint-vercel.vercel.app/api/collect-lead",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),o=await e.json();i(!1),e.ok&&o.success?(c(),n.reset(),t("LeadCollected",{email:a.email})):i(!1,"Email sudah terdaftar"===o.error?"Email ini sudah terdaftar.":"Terjadi kesalahan. Silakan coba lagi.")}catch(t){i(!1,"Gagal mengirim data. Periksa koneksi Anda."),console.error(t)}}),s&&s.addEventListener("click",d),o&&s&&o.addEventListener("click",()=>{s.classList.add("visible")})}
